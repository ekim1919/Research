\begin{figure}[t!]

\begin{algorithm}[H]
  \SetKwInput{KwInput}{Input}
  \SetKwInput{KwOutput}{Output}
  \SetKwFunction{AppendPCA}{AppendNewPCATemplates}
  \SetKwFunction{AppendLin}{AppendNewLinAppTemplates}
  \SetKwFunction{TransformBund}{TransformBundle}
  \SetKwFunction{UpdateTemp}{UpdateTemplates}
  \SetKwFunction{GetSupp}{GetSupportPoints}
  \SetKwFunction{PropPoints}{PropagatePointsOneStep}
  \SetKwFunction{PCA}{PCA}
  \SetKwFunction{ComputeGenRep}{ComputeGeneratorRepresentation}
  \SetKwFunction{ApproxLinearTrans}{ApproxLinearTrans}
  \SetKwFunction{SetLifeSpan}{SetLifeSpan}
  \SetKwFunction{AddTemptoBund}{AddTemplateToBundle}
  \SetKwFunction{RemoveTemp}{RemoveTempFromBund}
  \SetKwProg{Fun}{Proc}{:}{}

\SetAlgoLined
\DontPrintSemicolon

\KwInput{Dynamics $f$, Initial Parallelotope bundle $Q$, Step Bound $S$, Template Directions Matrix $\Lambda^Q$, Bundle Index Matrix $\T^Q$}
\KwOutput{Reachable Set Overapproximation $\overline\Theta_k$ for each step $k$}
$Q_0 \gets Q$ \;
 \For{$k \gets 1$ \KwTo $S$}{
    $Q_k \gets$ \TransformBund($f$, $Q_{k-1}$, $\Lambda$) \;
   $\overline\Theta_k \gets Q_k$ \;
 }
 \Return{$\overline\Theta_1 \ldots \overline\Theta_S$} \;
 \;
 %
 \Fun{\TransformBund{$f$, $Q$, $\Lambda^Q$}}{
   $Q' \gets \{\}$; $c_{u} \gets +\infty$; $c_{l} \gets -\infty$\;
   \For{$P \in \ptopeset{Q}$}{
     % $\tup{\T, c_{l}, c_{u}} \gets \mathsf{half-spaceRepresentation}(P)$\;
     $\langle a, g_1, \cdots, g_n \rangle \gets $ \ComputeGenRep($(P)$)\;
     $G_P \gets \Lambda_i^Q \cdot f(a + \sum_{i=1}^n \alpha_ig_i$) \;
     \For{each $\Lambda_i^Q$ in $\Lambda^Q$ }{
       $c_{u}'[i] \gets \mathsf{min}\{ \mathsf{optBox(G_P)}, c_{u}'[i] \}$ (Equation~\ref{eq:maxalpha})\;
       $c_{l}'[i] \gets \mathsf{max}\{ -1 \times \mathsf{optBox(-1 \times G_P)}, c_{l}'[i] \}$\;
     }
   }
   Construct parallelotopes $P_{1}', \ldots, P_{k}'$ from $\Lambda^Q, c_{l}', c_{u}'$ and indexes from $\T^Q$ \;

   $Q' \gets \{P_{1}', \ldots, P_{k}'\}$ \;
   \Return{$Q'$}
 }
\end{algorithm}
\caption{Reachable set computation using manual and static templates.}
\label{alg:old}
\end{figure}
